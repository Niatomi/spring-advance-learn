# Разработка REST сервиса

## Используемый стек технологий

- Java 8
- Maven 3.6.3
- JUnit 5.6.3
- Spring Boot 2.3.12.RELEASE
- PostgreSQL 10+

## Задача

Необходимо реализовать REST API по предоставлению сведений об клиентах системы.

### Атрибуты клиента
1. Фамилия
2. Имя
3. Отчество (необязательно для заполнения)
4. Пол
5. Дата рождения
6. Контактный телефон
7. Адрес электронной почты
8. Дата регистрации
9. Дата удаления (необязательно для заполнения)

### Методы REST API
1. Регистрации клиента. При регистрации клиента устанавливается дата регистрации
2. Изменение атрибутов клиента
3. Предоставление информации о клиенте по уникальному идентификатору
4. Предоставление списка клиентов по домену электронной почты, с пагинацией
5. Предоставление списка клиентов, с пагинацией
6. Предоставление списка клиентов, с пагинацией и сортировкой по фамилии
7. Удаление клиента

### Требования к форматно-логическому контролю
1. В качестве допустимых символов для атрибутов "фамилия", "имя", "отчество" допускается использование только русских символов и знака "-"
2. Значения атрибутов типа "Дата" должны быть валидными.
3. В качестве допустимых символов для атрибута "контактный телефон" могут использоваться символы "+-0123456789()" и пробел
4. Значение атрибута "адрес электронной почты" должно быть валидным
5. Значение атрибута "Дата регистрации" не может быть меньше значения атрибута "Дата рождения"
6. Значение атрибута "Дата удаления" не может быть меньше значения атрибута "Дата регистрации"
7. Значение атрибутов "Контактный телефон" и "Адрес электронной почты" не могут повторяться у разных клиентов

### Дополнительные требования
1. При создании, изменении, удалении клиента необходимо записывать информацию (идентификатор клиента, дата, тип события)
   об этих событиях в отдельную таблицу

### Требования к реализации
1. Сервис должен поддерживать как минимум слудующие профили:
    1. prod - конечный профиль для запуска на сервере
    2. test - тестовый профиль для запуска в тестовом окружении
2. Создание таблиц базы данных должно происходить через систему управления версиями базы данных Liquibase
3. Отдельно должны быть предоставлены скрипты по созданию тестового набора данных таблиц
4. В качестве СУБД:
    - для prod профиля должна быть использована PostgreSQL 10+
    - для test профиля должна быть использована H2
5. Работа с базой данных должна осуществляться с помощью фреймворка реализующего JPA
6. REST API должно быть реализовано с помощью фреймворка Spring MVC
7. В качестве транспортного формата данных должен использоваться JSON
8. В качестве библиотеки для преобразования объектов одного класса в объекты другого класса можно использовать Orika 1.4.6
   или MapStruct 1.4.2.Final (в связке с Lombok нужно использовать lombok-mapstruct-binding)
9. REST API должно быть задокументировано с помощью фреймворка OpenAPI
11. Коммиты, при работе над проектом, должны делаться регулярно. Не должно получиться так, что проект попал в репозиторий
    в виде одного большого коммита. Должна быть серия коммитов, показывающая прогресс работы над проектом.
    Комментарии к коммитам должны быть осмысленными

## Вывод

1. Атрибуты, а также требования к форматно-логическому контролю представлены в классе [модели](src/main/java/ru/niatomi/restClientService/model/domain/Client.java)
   * Котроль за датой регистрации и удаления представлен в [валидаторе](src/main/java/ru/niatomi/restClientService/model/validation/validator/DateLessThanValidator.java)
2. Реализованы и задокументированы все необходимые методы REST API, документация OpenAPI к ним доступна по ссылке:  
`http://localhost:8080/api/swagger-ui/index.html#`
3. Сервис имеет два профиля для запуска
   * [prod](src/main/resources/application-prod.yml)
   * [test](src/main/resources/application-test.yml)

Выбор профиля осуществляется в [application.yml](src/main/resources/application.yml) изменением конфигурации `active` 
   ```yml
     profiles:
       active: test
   ```
4. Создание таблиц базы данных осуществляется через систему управления версиями базы данных Liquibase, список изменений для Liquibase расположен в [директории](src/main/resources/db)
5. Скрипты по созданию тестовых данных расположены в [файле](src/main/resources/db/changelogs/11-01-changelog.xml) 
6. Для prod конфигурации используется PostgreSQL 14

   ```yml
   datasource:
    platform: postgres
    url: jdbc:postgresql://localhost:5432/clients_db
    username: {username}
    password: {password}
   ```
   
   Для test конфигурации используется H2

   ```yml
   datasource:
    platform: h2
    url: jdbc:h2:mem:clientsDB;DATABASE_TO_LOWER=TRUE
    username: testUser
    password: testUser
    driverClassName: org.h2.Driver
   ```

7. В качестве библиотеки для преобразования объектов одного класса в объекты другого класса используется MapStruct 1.4.2.Final
   Реализация представлена в [директории](src/main/java/ru/niatomi/restClientService/mapper)

8. [Осуществлена](src/main/java/ru/niatomi/restClientService/event) запись информации в отдельную таблицу о создании, изменении, удалении в основной таблице.